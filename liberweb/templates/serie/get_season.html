{% extends "base.html" %}
{% load i18n %}
{% load thumbnail %}
{% load extract_domain %}
{% load voting_tags %}
{% load message_box %}
{% block title %}{{serie.name|title}} - {% trans "Season" %} {{ season.season }}{% endblock %}
{% block extrastyle %}   
    <link rel="stylesheet" href="/static/css/jquery.colorbox.css" type="text/css" />
    <link rel="stylesheet" href="/static/css/queryLoader.css" type="text/css" />{% endblock %}
{% block extrahead %}
    <script type="text/javascript" src="/static/js/jquery.colorbox.js"></script>
    <script type="text/javascript" src="/static/js/queryLoader.js"></script>
    <script>
    $(document).ready(function(){
      $(".add_link").colorbox({iframe:true, innerWidth:555, innerHeight:324});
    });
	$(document).ready(function() {
	    $('#links tr').click(function() {
		var href = $(this).find("a").attr("href");
		if(href) {
		    window.location = href;
		}
	    });

	});
    </script>
{% endblock %}
{% block contents %}
{% votes_by_user user on link_list as vote_dict %}
{% scores_for_objects link_list as score_dict %}
{{ episode }}

{% if message == "No registrado" %}
  {% message_box "Debe <a href='/accounts/login'>registrarse o iniciar sesion</a> para votar" %}
{% endif %}

<!-- TITLE -->
<h2 class="grid_12 caption clearfix"><a href="{{ serie.get_absolute_url }}">{{serie.name|title}}</a> - <span>Season {{season.season}}</span><a class="right button" href="{{ serie.get_absolute_url }}">Go back to {{serie.name|title}}</a></h2>
<div class="hr clearfix dotted">&nbsp;</div>

{% for episode in episode_list %} 
<div class="catagory_1 clearfix">
<!-- COLUMN 1 -->
<div class="grid_4 textright" >
	<span class="meta">{% trans "Episodio "%}{{episode.episode}}</span><br />
	<span class="meta">{% trans "Emitido el "%}{{episode.air_date }}</span>
	<h4 class="title "><a href="{{ episode.get_absolute_url }}">{% if episode.title %}{{ episode.title }}{% else %}Episode {{ episode.episode }}{% endif %}</a></h4>
	<div class="hr clearfix dotted">&nbsp;</div>
	<p>{{ episode.description }}</p>
</div>
<!-- COLUMN 2 -->
<div class="grid_3">
	{% if episode.images.all.0.src %}
		{% thumbnail episode.images.all.0.src "200x200" as img_epi %}
		<img class="img_epi" src="{{ img_epi.url }}">
		{% endthumbnail %}
	{% else %}
		<img src="/static/images/image_not_available.png" height=100>
	{% endif %}
</div>

<!-- COLUMN 3 -->
<div class="grid_5 right">
	{% if episode.links.all %}
	<table id="links">
	    <thead>
		<tr>
			<th scope="col">{% trans "Link" %}</th>
			<th scope="col">{% trans "Audio" %}</th>
			<th scope="col">{% trans "Subtitulos" %}</th>
			<th scope="col">{% trans "Votos" %}</th>
		</tr>
	    </thead>
	    <tbody>
		{% for link in episode.links.all %}
		<tr>
		<td><a href="{{ link.url }}"> {{ link.url|extract_domain }}</a></td>
		<td>{{ link.audio_lang }}</td>
		<td>{% if link.subtitle %}{{ link.subtitle }}{% else %}{% endif%}</td>
		<td>
		<!-- VOTING -->
                {% score_for_object link as score %}
			<form class="linkvote" id="linkup{{ link.id }}" action="." method="POST">
			  <input type="hidden" name="vote" value="upvote"/>
			  <input type="hidden" name="linkid" value="{{ link.id }}"/>
			  <input type="image" id="linkuparrow{{ link.id }}" src="/static/images/voting/aup{% if vote and vote.is_upvote %}mod{% else %}grey{% endif %}.gif">
			</form>
			<a href="{{ link.url }}">{{ link.title|escape }}</a></h2>
			  <span class="score" id="linkscore{{ link.id }}"
				title="after {{ score.num_votes|default:0 }} vote{{ score.num_votes|default:0|pluralize }}">
			   {{ score.score|default:0 }} 
			  </span>
			<form class="linkvote" id="linkdown{{ link.id }}" action="." method="POST">
			  <input type="hidden" name="vote" value="downvote"/>
			  <input type="hidden" name="linkid" value="{{ link.id }}"/>
			  <input type="image" id="linkdownarrow{{ link.id }}" src="/static/images/voting/adown{% if vote and vote.is_downvote %}mod{% else %}grey{% endif %}.gif">
			</form>
			</td>
		</tr>
		{% endfor %}
		{% if request.user.is_authenticated %}
			<a class="add_link button" href="{{ episode.get_add_link_url }}">{% trans "Add Link" %}</a> 
		{% else %}
			{% trans "Para añadir enlaces debes haber iniciado sesion." %}
		{% endif %}
	    </tbody>
	</table>
      {% else %}
		{% if request.user.is_authenticated %}
			<a class="add_link button" href="{{ episode.get_add_link_url }}">{% trans "Add Link" %}</a> 
		{% else %}
			{% trans "Para añadir enlaces debes haber iniciado sesion." %}
		{% endif %}
      {% endif %}
			</div>
		</div>
		<div class="pr clearfix grid_12">&nbsp;</div>
	{% endfor %}
<script type='text/javascript'>
	QueryLoader.init();
</script>

{% endblock %}
