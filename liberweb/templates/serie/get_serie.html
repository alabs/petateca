{% extends "base.html" %}
{% load i18n %}
{% load thumbnail %}
{% load comments %}
{% load extract_domain %}
{% load message_box %}
{% block extrastyle %}   
    <link rel="stylesheet" href="/static/css/jquery.rating.css" type="text/css" />
    <link rel="stylesheet" href="/static/css/queryLoader.css" type="text/css" />{% endblock %}
{% block extrahead %}
    <script type="text/javascript" src="/static/js/jquery.MetaData.js"></script>
    <script type="text/javascript" src="/static/js/jquery.rating.js"></script>
    <script type="text/javascript" src="/static/js/queryLoader.js"></script>
<script type="text/javascript">

var url = "{{request.path }}";
$(document).ready(function(){
//    $(".redhearthover").hover(function() {
//       $(this).attr('src', '/static/images/heart_black.png');
//}, function(){
//       $(this).attr('src', '/static/images/heart_red.png');
//    });
//    $(".blackhearthover").hover(function() {
//       $(this).attr('src', '/static/images/heart_red.png');
//}, function(){
//       $(this).attr('src', '/static/images/heart_black.png');
//    });
	$('.ratingstar').rating({ callback: function(value, link){
		$.post(url, { 'rating': value }); }
	});

});

function favorite(decision) {
        $('#favorite').html('<img src="/static/images/ajax-loading.gif">');
	if (decision == "yes") {
		$.post(url, { 'favorite': "favorite" },
			function(data){
				if (data == 'yes'){
				//	$('#favorite').html("<a href='' onclick='favorite('no');' id='favorite'><img class='redhearthover' src='/static/images/heart_red.png'></a>");
					var html = "<a href='' onclick='favorite('no');' id='favorite'><img class='redhearthover' src='/static/images/heart_red.png'></a>";
					$('#favorite').text(html).html();
					console.log(data);
				}
			}
		)
		return false;
	} else if (decision == "no"){
		                $.post(url, { 'no-favorite': "no-favorite" },
                        function(data){
                                if (data == 'no'){
					var html = "<a href='' onclick='favorite('yes');' id='favorite'><img class='blackhearthover' src='/static/images/heart_black.png'></a>";
					$('#favorite').text(html).html();
					//$('#favorite').html("&lt;a href=&quot;#&quot; onclick=&quot;favorite(&#39;yes&#39;);&quot; id=&quot;favorite&quot;&gt;&lt;img class=&quot;blackhearthover&quot; src=&quot;/static/images/heart_black.png&quot;&gt;&lt;/a&gt;");
                                        console.log(data);
                                        
                                }
                        }
                )
                return false;
	}
}

    //$linkscore.html('<img src="/static/images/ajax-loading.gif">');

</script>{% endblock %}
{% block contents %}
<!-- MESSAGES -->
{% spaceless %}
    {% if message == "No registrado" %}{% message_box "Debe <a href='/accounts/login/'>registrarse o iniciar sesion</a> para votar" %} 
    {% else %}{% if message == "Vote recorded" %}{% message_box "Voto registrado" %}
    {% else %}{% if message == "You have already voted" %}{% message_box "Ya ha votado" %}
    {% else %}{% if message %}{% message_box "{{ message }}" %}
    {% endif %}{% endif %}{% endif %}{% endif %}
    {% if error %}{% message_box "Couldn't vote :/" %}{% endif %}
{% endspaceless %}
<!-- COLUMN 1 -->
<div class="grid_3">
	<!-- IMAGE -->
	{% if image %}{% thumbnail image "400x300" as img_serie %}
	<img id="poster" src="{{ img_serie.url }}" />{% endthumbnail %}
	{% else %}<div class="image_not_found">  <img src="/static/images/image_not_available.png" height=100> </div>
	{% endif %}
	<!-- RATING -->
	  <div id="rating">
	    <form action="." method="POST">
	      <input type="radio" name="rating" value="1" class="ratingstar" {% if score == 1 %}checked="checked"{% endif %}/>
	      <input type="radio" name="rating" value="2" class="ratingstar" {% if score == 2 %}checked="checked"{% endif %}/>
	      <input type="radio" name="rating" value="3" class="ratingstar" {% if score == 3 %}checked="checked"{% endif %}/>
	      <input type="radio" name="rating" value="4" class="ratingstar" {% if score == 4 %}checked="checked"{% endif %}/>
	      <input type="radio" name="rating" value="5" class="ratingstar" {% if score == 5 %}checked="checked"{% endif %}/>
	    </form>
	  </div>
	<div class="hr dotted clearfix">&nbsp;</div>
	<!-- NETWORK -->
	{% if serie.network.name %}
	<h4>{% trans "Cadena" %}:</h4> 
		<a class="button float" href="{{ serie.network.get_absolute_url }}">{{ serie.network.name }}</a>
	{% endif %}
	<div class="hr dotted clearfix">&nbsp;</div>
	<!-- GENRE -->
	<h4>{% trans "Genero" %}:</h4> 
      		{% for genre in serie.genres.all %}
			<a class="button float" href="{{ genre.get_absolute_url}}">{{ genre.name }}</a>
		{% endfor %}
	<div class="hr dotted clearfix">&nbsp;</div>
	<!-- RUNTIME -->
	<h4>{% trans "Duracion" %}:</h4> {{ serie.runtime }} {% trans "minutos" %}
		<div class="hr dotted clearfix">&nbsp;</div>
	<!-- BUTTONS -->
		<p class="clearfix">
		<a href="/series" class="button float">&lt;&lt; {% trans "Regresar a las Series" %}</a>
		</p>
		<p class="clearfix">
		{% get_comment_count for serie as comment_count %}
		<a href="#comments" class="button float">{{comment_count}} Comments</a>
		</p>
</div>

		
<!-- COLUMN 2 -->
<div class="grid_7">
	<!-- TITLE -->
	<h1 class="title float" style="text-align:center;">{{serie.name|title}}</h1>
	<!-- FAVORITE -->
	<div id="favorite">
	  {% if favorite == "no" %}
		<a href="#" onclick="favorite('yes');" id="favorite"><img class="blackhearthover" src="/static/images/heart_black.png"></a>
	  {% else %} 
	  {% if favorite == "yes" %}
		<a href="#" onclick="favorite('no');" id="favorite"><img class="redhearthover" src="/static/images/heart_red.png"></a>
	    {% endif %}
	    {% endif %}
	</div>
	<div class="hr dotted clearfix">&nbsp;</div>
	<!-- DESCRIPTION -->
	<p class="clearfix"> {{ serie.description }}</p>
	<!-- ACTORS -->
	<div class="hr clearfix">&nbsp;</div>
	<h2>{% trans "Actores" %}</h2>
	<div class="hr dotted clearfix">&nbsp;</div>
	{% for actor in serie.actors.all %}
		{% if actor.role_set.all.0.role %}
			<a class="portfolio_item float alpha actor" href="{{ actor.get_absolute_url }}">
			<span>{{ actor.name }} as {{actor.role_set.all.0.role}}</span>
		       {% if actor.images.get %}{% thumbnail actor.images.get.src "180x180" as img_actor %}
			<img id="actor_list" src="{{ img_actor.url }}" />{% endthumbnail %}
			{% else %}<img id="actor_unknown" width="120" height="180" src="/static/images/image_not_available.png">
			{% endif %}
			</a>
		{% endif %}
	{% endfor %}
</div>

<!-- COLUMN 3 -->
<div class="grid_1">
	<!-- SEASONS -->
	<h2><span>{% trans "Temporadas" %}</span></h2>
	{% for season in season_list %}
		<a class="portfolio_item float alpha" href="{{ season.get_absolute_url }}">
		<span>{% trans "Temp" %} {{ season.season }}</span> 
		{% if season.images.all.0 %} {% thumbnail season.images.all.0.src "180x160" as img_season %} 
			<img src="{{ img_season.url }}" alt=""/>{% endthumbnail %}
		{% else %}
			{% if image %}{% thumbnail image "180x160" as img_serie %}
			<img src="{{ img_serie.url }}" />{% endthumbnail %}
			{% else %}<div class="image_not_found">  <img src="/static/images/image_not_available.png" width=110> </div>
			{% endif %}
		{% endif %}
	</a>{% endfor %}
</div>

<div class="hr clearfix">&nbsp;</div>
<div id="comments">
	<!-- COMMENTS -->
	<h2> Comments </h2>
	{% render_comment_list for serie %}
	{% if comment_count == 0 %}
	<p>{% trans "Aún no hay comentarios. ¡Sé el primero!" %}</p>
	{% endif %}

	<!-- ADD A COMMENT -->
	{% with request.path as next %}
	{% render_comment_form for serie %}
	{% endwith %}
</div>
<script type='text/javascript'>
	QueryLoader.init();
</script>

{% endblock %}
