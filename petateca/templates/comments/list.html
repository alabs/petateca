{% load avatar_tags %}
{% load voting_tags %}

{% votes_by_user user on comment_list as vote_dict %}
{% scores_for_objects comment_list as score_dict %}
{% url user_profile user_name=comment.user.username as user_profile %}

<ol class="commentlist">
<div class="hr dotted clearfix">&nbsp;</div>
    {% for comment in comment_list %}{% ifchanged comment.parent_id %}{% else %}</li>{% endifchanged %}{% if not comment.open and not comment.close %}</li>{% endif %}{% if comment.open %}
                    <ul>{% endif %}

    {% dict_entry_for_item comment from score_dict as score %}
    {% dict_entry_for_item comment from vote_dict as vote %}

    <li class="comment_li depth-{{ comment.depth }}" id="comment_{{ comment.id }}">
        <div class="left"> 
            <div class="vote" {% if user.is_authenticated %}{% else %}style="display: none;"{% endif %}>
                {% if vote.is_upvote %}
                <a href="javascript:vote_comment({{ comment.id }},'clear')" class="up"><img  class="nobottom" src="/static/images/voting/aupmod.gif"></img></a>
                {% else %}
                <a href="javascript:vote_comment({{ comment.id }},'up')" class="up"><img class="nobottom" src="/static/images/voting/aupgrey.gif"></img></a>
                {% endif %}
            </div>
            <p class="score">{{ score.score }}</p>
            <div class="vote" {% if user.is_authenticated %}{% else %}style="display: none;"{% endif %}>
                {% if vote.is_downvote %}
                <a href="javascript:vote_comment({{ comment.id }},'clear')" class="down"><img  class="nobottom" src="/static/images/voting/adownmod.gif"></img></a>
                {% else %}
                <a href="javascript:vote_comment({{ comment.id }},'down')" class="down"><img class="nobottom"  src="/static/images/voting/adowngrey.gif"></img></a>
                {% endif %}
            </div>
        </div>
        <div class="gravatar">
            <a href="{{ user_profile }}">
            {{ user_profile }}
            {% avatar comment.user 50 %}
            </a>
            <a href="#comment_{{ comment.id }}" class="comment-reply-link">Contestar</a>
        </div>
        <div class="comment_content">
            <div class="clearfix">
                <cite class="author_name">
                    <a href="{{ user_profile }}">{{ comment.user.username }}</a>
                </cite> ({{ comment.date_submitted|date:"SHORT_DATETIME_FORMAT"  }}
            </div>
            <div class="comment_text">
                    <p>{{comment.comment}}</p>
            </div>
        </div>
                        {% for close in comment.close %}</li></ul>{% endfor %}
<div class="hr dotted clearfix">&nbsp;</div>
{% endfor %}
</ol>
