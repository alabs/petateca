{% extends "base.html" %}
{% load i18n %}
{% load thumbnail %}
{% load voting_tags %}
{% votes_by_user user on episode.links.all as vote_dict %}
{% load extract_domain %}
{% load message_box %}
{% block extrastyle %}   
    <link rel="stylesheet" href="/static/css/jquery.colorbox.css" type="text/css" />{% endblock %}
{% block extrahead %}
    <script type="text/javascript" src="/static/js/jquery.colorbox.js"></script>
    <script>
    $(document).ready(function(){
      $(".add_link").colorbox({iframe:true, innerWidth:535, innerHeight:184});
    });
    </script>
{% endblock %}
{% block contents %}
	<h2 class="grid_12 caption clearfix"><a href="{{ serie.get_absolute_url }}">{{ serie.name|title }}</a> - {{ episode.season.season }}x{{ episode.episode }} - {{ episode.title|title }}
  <a href="{{ season.get_absolute_url }}" class="button right">{% trans "Regresar a Temporada" %} {{season.season}}</a>
</h2>
<div class="grid_5 portfolio">
	{% if episode.images.all.0.src %}
	  {% thumbnail episode.images.all.0.src "300x300" as img_episode %}
	    <img src="{{ img_episode.url }}">
	  {% endthumbnail %}
	{% endif %}
</div>
<div class="grid_5">
	<span class="title"> 
	<span class="meta">{% trans "Descripci칩n" %}</span><p style="font-size:14px;">{{ episode.description }}</p>
	<span class="meta">{% trans "Duraci칩n" %} </span><p>{{ serie.runtime }} {% trans "minutos" %}</p>
	<span class="meta">{% trans "Fecha de Emisi칩n" %} </span><p> {{ episode.air_date }}</p>
</div>

{% if message == "No registrado" %}
  {% message_box "Debe <a href='/accounts/login'>registrarse o iniciar sesion</a> para votar" %}
{% else %}{% if message == "Vote recorded" %}
  {% message_box "Su voto ha sido guardado" %}
{% endif %}
{% endif %}

<div class="grid_12">
<a class="add_link button" href="{{ episode.get_add_link_url }}">{% trans "A침adir enlace" %}</a> 
<h2> Links </h2>
	{% if episode.links.all %}
	<table id="links">
	    <thead>
		<tr>
			<th scope="col">Link</th>
			<th scope="col">Audio</th>
			<th scope="col">Subtitles</th>
			<th scope="col">Votes</th>
		</tr>
	    </thead>
	    <tbody>
		{% for link in episode.links.all %}
		<tr>
		<td><a href="{{ link.url }}"> {{ link.url|extract_domain }}</a></td>
		<td>{{ link.audio_lang }}</td>
		<td>{% if link.subtitle %}{{ link.subtitle }}{% else %}{% endif%}</td>
		<td>
		<!-- VOTING -->
{{vote_dict}}
		{% dict_entry_for_item link from vote_dict as vote %}
                {% score_for_object link as score %}
			<a href="#epi{{ episode.episode }}" onclick="vote('{{ link.id }}', 'upvote');" id="linkuparrow{{ link.id }}"><img src="/static/images/voting/aup{% if vote and vote.is_upvote %}mod{% else %}grey{% endif %}.gif"></a>
			<a href="#epi{{ episode.episode }}" onclick="vote('{{ link.id }}', 'downvote');" id="linkdownarrow{{ link.id }}"><img src="/static/images/voting/adown{% if vote and vote.is_downvote %}mod{% else %}grey{% endif %}.gif"></a>
			  <span class="score right" style="position:relative; top:-25%;" id="linkscore{{ link.id }}" title="after {{ score.num_votes|default:0 }} vote{{ score.num_votes|default:0|pluralize }}">{{ score.score|default:0 }}</span>
		</td>
		</tr>
		{% endfor %}
	    </tbody>
	</table>
      {% else %}
         {% trans "No hay enlaces disponibles" %}
      {% endif %}
</div>
<br />

{% endblock %}

